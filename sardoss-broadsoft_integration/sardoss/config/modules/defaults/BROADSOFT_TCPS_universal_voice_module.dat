
###############################################
#   BROADSOFT_TCPS_universal_voice_module
###############################################

!
no ip nat service sip udp port 5060
!
ip dhcp pool [VAR_IADNAME]
option 66 ascii http://phones.cbeyond.net:80/dms/default/
!
policy-map SIP_LAN_QOS
class signaling
set precedence 4
class media
set precedence 5
!
int [VAR_DATA_INTERFACE]
service-policy input SIP_LAN_QOS
! 
int [VAR_UPSTREAM_INTERFACE]
h323-gateway voip bind srcaddr [VAR_IAD_SERIAL_IP]
!
voice service voip 
fax protocol pass-through g711ulaw
modem passthrough nse codec g711ulaw
sip      
bind control source-interface [VAR_UPSTREAM_INTERFACE]
bind media source-interface [VAR_UPSTREAM_INTERFACE]
rel1xx disable
asserted-id pai
localhost dns:[VAR_BWAS_FQDN]
!
application
service dsapp
param callWaiting TRUE
param callHold TRUE
param callConference TRUE
param callTransfer TRUE
!
voice class codec 711
codec preference 1 g711ulaw
!
voice translation-rule 1
 rule 1 /\(.*\)/ /011\1/ type international unknown plan isdn unknown
!
!
voice translation-profile CBEY_INTL_PREFIX
 translate called 1
!
isdn switch-type primary-ni
!
voice rtp send-recv
!
dial-peer voice 500 voip
translation-profile outgoing CBEY_INTL_PREFIX
huntstop    
preference 1
service session
destination-pattern .T
progress_ind setup enable 3
progress_ind callproc strip 8
session protocol sipv2
session target sip-server  
session transport udp
voice-class codec 711
dtmf-relay rtp-nte
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad    
!
dial-peer voice 501 voip
description National Dial Plan Dialing
huntstop
service dsapp 
destination-pattern [2-9].........
progress_ind setup enable 3
voice-class codec 711
session protocol sipv2
session target sip-server  
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad   
!         
dial-peer voice 502 voip
description Bell Star Codes
huntstop
service dsapp
destination-pattern *..
progress_ind setup enable 3 
voice-class codec 711
session protocol sipv2
session target sip-server 
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad 
!
dial-peer voice 503 voip
description Local 7 Digit Dialing
huntstop
service dsapp
destination-pattern [2-9]......T
progress_ind setup enable 3
voice-class codec 711
session protocol sipv2
session target sip-server
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad  
!         
dial-peer voice 504 voip
description Long-distance Dialing
huntstop
service dsapp
destination-pattern 1[2-9].........
progress_ind setup enable 3
voice-class codec 711
session protocol sipv2
session target sip-server  
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad   
!         
dial-peer voice 505 voip
description International Dialing
huntstop
service dsapp
destination-pattern 011T
progress_ind setup enable 3
voice-class codec 711
session protocol sipv2
session target sip-server  
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad   
!         
dial-peer voice 506 voip
description Service Number (911, 411, etc)
huntstop
service dsapp
destination-pattern [2-9]11
progress_ind setup enable 3 
voice-class codec 711
session protocol sipv2
session target sip-server  
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad 
!
dial-peer voice 507 voip
description Speed-Dial
huntstop
service dsapp
destination-pattern [2-9]T
progress_ind setup enable 3
voice-class codec 711
session protocol sipv2
session target sip-server
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad 
!
dial-peer voice 508 voip
description Casual Dialing
huntstop
service dsapp
destination-pattern 101...............
voice-class codec 711
session protocol sipv2
session target sip-server
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad
!
dial-peer voice 509 voip
description Outbound CatchAll
huntstop
service dsapp
destination-pattern .T
progress_ind setup enable 3
voice-class codec 711
session protocol sipv2
session target sip-server
session transport udp
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad
!
dial-peer voice 588 voip
preference 2
service session
voice-class codec 711
session protocol sipv2
session target sip-server
incoming called-number .%
dtmf-relay rtp-nte
ip qos dscp cs5 media
ip qos dscp cs4 signaling
no vad
!
sip-ua 
authentication username [VAR_ACCT_NUM] password [VAR_IADNAME]
calling-info pstn-to-sip asserted-id number set [VAR_BTN]
no remote-party-id
set pstn-cause 47 sip-status 486
retry invite 2
retry response 3
retry bye 3
retry prack 6
retry notify 5
timers expires 300000 
timers notify 1000
mwi-server ipv4:255.255.255.255 expires 3600 port 5060 transport udp unsolicited
registrar dns:[VAR_BWAS_FQDN] expires 300   
sip-server dns:[VAR_BWAS_FQDN]
!
telephony-service
max-conferences 4 gain -6
transfer-system full-consult
!
